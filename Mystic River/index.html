<!DOCTYPE html>
<html>
<head>
<title>Project Title</title>
<meta charset="utf-8">
<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui" />
<style> @-ms-viewport { width: device-width; } </style>
<link rel="stylesheet" href="vendor/reset.min.css">
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

</head>
<body class="multiple-scenes ">

<div id="pano"></div>

<div id="sceneList">
  <ul class="scenes">
    
      <a href="javascript:void(0)" class="scene" data-id="0-frames_0038">
        <li class="text">1 - Dugger Park</li>
      </a>
    
      <a href="javascript:void(0)" class="scene" data-id="1-frames_0039">
        <li class="text">2</li>
      </a>
    
      <a href="javascript:void(0)" class="scene" data-id="2-frames_0040">
        <li class="text">3</li>
      </a>
    
      <a href="javascript:void(0)" class="scene" data-id="3-frames_0041">
        <li class="text">4</li>
      </a>
    
      <a href="javascript:void(0)" class="scene" data-id="4-frames_0042">
        <li class="text">5</li>
      </a>
    
      <a href="javascript:void(0)" class="scene" data-id="5-frames_0043">
        <li class="text">6 - Harvard Ave. Bridge</li>
      </a>
    
      <a href="javascript:void(0)" class="scene" data-id="6-frames_0044">
        <li class="text">7</li>
      </a>
    
      <a href="javascript:void(0)" class="scene" data-id="7-frames_0045">
        <li class="text">8</li>
      </a>
    
      <a href="javascript:void(0)" class="scene" data-id="8-frames_0046">
        <li class="text">9</li>
      </a>
    
      <a href="javascript:void(0)" class="scene" data-id="9-frames_0047">
        <li class="text">10</li>
      </a>
    
      <a href="javascript:void(0)" class="scene" data-id="10-frames_0048">
        <li class="text">11</li>
      </a>
    
  </ul>
</div>

<div id="titleBar">
  <h1 class="sceneName"></h1>
</div>

<a href="javascript:void(0)" id="autorotateToggle">
  <img class="icon off" src="img/play.png">
  <img class="icon on" src="img/pause.png">
</a>

<a href="javascript:void(0)" id="fullscreenToggle">
  <img class="icon off" src="img/fullscreen.png">
  <img class="icon on" src="img/windowed.png">
</a>

<a href="javascript:void(0)" id="sceneListToggle">
  <img class="icon off" src="img/expand.png">
  <img class="icon on" src="img/collapse.png">
</a>

<a href="javascript:void(0)" id="viewUp" class="viewControlButton viewControlButton-1">
  <img class="icon" src="img/up.png">
</a>
<a href="javascript:void(0)" id="viewDown" class="viewControlButton viewControlButton-2">
  <img class="icon" src="img/down.png">
</a>
<a href="javascript:void(0)" id="viewLeft" class="viewControlButton viewControlButton-3">
  <img class="icon" src="img/left.png">
</a>
<a href="javascript:void(0)" id="viewRight" class="viewControlButton viewControlButton-4">
  <img class="icon" src="img/right.png">
</a>
<a href="javascript:void(0)" id="viewIn" class="viewControlButton viewControlButton-5">
  <img class="icon" src="img/plus.png">
</a>
<a href="javascript:void(0)" id="viewOut" class="viewControlButton viewControlButton-6">
  <img class="icon" src="img/minus.png">
</a>

<script src="vendor/screenfull.min.js" ></script>
<script src="vendor/bowser.min.js" ></script>
<script src="vendor/marzipano.js" ></script>

<script src="data.js"></script>
<script src="index.js"></script>
<div id="map" style="width: 400px; height: 300px; position: absolute; top: 60px; right: 10px; z-index: 1000;"></div>

<script>
// Initialize the Leaflet map
var map = L.map('map').setView([42.4189, -71.1422], 13); // Default location and zoom

// Define the different map layers
var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
});

var satelliteLayer = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
    subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
    attribution: '&copy; Google'
});

// Add MassMapper WMS layer
var massMapperWMS = L.tileLayer.wms("https://gis-prod.digital.mass.gov/geoserver/wms", {
    layers: 'massgis:GISDATA.IMG_SHADEDRELIEF_LIDAR',
    format: 'image/png',
    transparent: true,
    attribution: 'MassGIS'
});

// Add the new Shaded Relief ArcGIS layer
var shadedReliefLayer = L.tileLayer('https://tiles.arcgis.com/tiles/hGdibHYSPO59RG1h/arcgis/rest/services/LiDAR_ShadedRelief/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'Shaded Relief &copy; <a href="https://www.arcgis.com/home/item.html?id=5fb17dfad618421f8d2513a805a2a7b5">ArcGIS</a>'
});
	
// Add the default layer (OpenStreetMap) to the map
osmLayer.addTo(map);


// List of GPS coordinates for each scene (example with 4 scenes, add more as needed)
var markers = [
    
    { lat: 42.41567, lon: -71.13886, title: 'Frame 38', sceneId: '37-frames_0038' },
    { lat: 42.41564, lon: -71.13877, title: 'Frame 39', sceneId: '38-frames_0039' },
    { lat: 42.41561, lon: -71.13869, title: 'Frame 40', sceneId: '39-frames_0040' },
    { lat: 42.41557, lon: -71.13857, title: 'Frame 41', sceneId: '40-frames_0041' },
    { lat: 42.41555, lon: -71.13851, title: 'Frame 42', sceneId: '41-frames_0042' },
    { lat: 42.41551, lon: -71.13838, title: 'Frame 43', sceneId: '42-frames_0043' },
    { lat: 42.41547, lon: -71.13825, title: 'Frame 44', sceneId: '43-frames_0044' },
    { lat: 42.41541, lon: -71.13806, title: 'Frame 45', sceneId: '44-frames_0045' },
    { lat: 42.41535, lon: -71.13790, title: 'Frame 46', sceneId: '45-frames_0046' },
    { lat: 42.41532, lon: -71.13776, title: 'Frame 47', sceneId: '46-frames_0047' },
    { lat: 42.41528, lon: -71.13756, title: 'Frame 48', sceneId: '47-frames_0048' }
	
];

// Add markers for each scene
// Add draggable markers for each scene
markers.forEach(function(marker) {
    var popupContent = "<b>" + marker.title + "</b><br><a href='#' onclick=\"switchScene('" + marker.sceneId + "')\">View Panorama</a>";
    
    // Create a draggable marker
    var mapMarker = L.marker([marker.lat, marker.lon], {draggable: true}).addTo(map).bindPopup(popupContent);
    
    // Event listener to capture the new position after dragging
    mapMarker.on('dragend', function(e) {
        var newLatLng = e.target.getLatLng();
        console.log("Updated coordinates for " + marker.title + ": ", newLatLng.lat, newLatLng.lng);
        // Here you can update your marker's coordinates or log them as needed
    });
});

// Define the base layers (to be toggled)
var baseMaps = {
    "OpenStreetMap": osmLayer,
    "Satellite View": satelliteLayer,
"Hillshade": shadedReliefLayer
};

// Add the layer control to the map (for toggling between layers)
L.control.layers(baseMaps).addTo(map);

// Function to switch scenes (assuming a function like this already exists)
function switchScene(sceneId) {
    var sceneElement = document.querySelector(`[data-id='${sceneId}']`);
    if (sceneElement) {
        sceneElement.click();  // Simulate click to switch scene
    } else {
        console.error('Scene not found: ' + sceneId);
    }
}
</script>
</body>
</html>